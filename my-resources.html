<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Resources | TimeBank</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen flex flex-col bg-gradient-to-br from-indigo-100 via-purple-200 to-pink-100">

  <!-- NAVBAR -->
  <nav class="sticky top-0 z-50 backdrop-blur-lg bg-white/80 shadow-md">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">

      <h1 class="text-xl sm:text-2xl font-extrabold flex items-center gap-2 cursor-pointer text-indigo-700"
        onclick="location.href='dashboard.html'">
        <svg class="h-6 w-6 sm:h-7 sm:w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        TimeBank
      </h1>

      <div class="hidden md:flex items-center gap-6 font-medium">
        <a href="dashboard.html" class="hover:text-indigo-600">Dashboard</a>
        <a href="my-services.html" class="hover:text-indigo-600">My Services</a>
        <a href="upload-resource.html" class="hover:text-indigo-600">Upload New</a>
        <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded-lg text-white hover:bg-red-600">
          Logout
        </button>
        <button onclick="location.href='profile.html'" class="w-10 h-10 rounded-full flex items-center justify-center
         text-indigo-600 hover:text-indigo-600
         hover:bg-indigo-50 transition" title="Profile">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5
             2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3
             c0-3.3-6.7-5-10-5z" />
          </svg>
        </button>
      </div>

      <button class="md:hidden text-2xl" onclick="toggleMenu()">‚ò∞</button>
    </div>

    <!-- MOBILE MENU -->
    <div id="mobileMenu" class="hidden md:hidden bg-white px-5 py-4 space-y-4 text-sm text-gray-800">
      <a href="dashboard.html" class="block">Dashboard </a>
      <a href="my-services.html" class="block">My Services</a>
      <a href="upload-resource.html" class="block">Upload New</a>
      <button onclick="logout()" class="w-full bg-red-500 text-white py-2.5 rounded-lg font-medium"> Logout</button>

      <!-- Profile Button -->
      <button onclick="location.href='profile.html'" class="w-full flex items-center justify-center gap-2
           border border-gray-300 py-2.5 rounded-lg text-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5
                 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3
                 c0-3.3-6.7-5-10-5z" />
        </svg>
        Profile
      </button>
    </div>
  </nav>

  <!-- PAGE -->
  <main class="max-w-6xl mx-auto px-4 py-12 flex-1">

    <h2 class="text-4xl font-extrabold mb-8 text-center text-gray-800">
      My Uploaded Resources
    </h2>

    <!-- SEARCH BAR (FULL WIDTH) -->
    <div class="w-full mb-14">
      <input id="search" type="text" placeholder="üîç Search your resources..." class="w-full px-6 py-4 rounded-2xl border shadow-lg
               focus:ring-2 focus:ring-indigo-400 outline-none text-lg" onkeyup="filterResources()" />
    </div>

    <!-- LIST -->
    <div id="list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10 justify-items-center">
    </div>

  </main>

  <footer class="text-center text-gray-500 py-6 text-sm">
    ¬© 2026 TimeBank | SkillShare Platform.
  </footer>

  <!-- EDIT MODAL -->
  <div id="editModal" class="fixed inset-0 hidden bg-black/60 items-center justify-center z-50">
    <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl">
      <h3 class="text-2xl font-bold mb-5 text-gray-800">‚úè Edit Resource</h3>

      <input id="modal-title" class="w-full border rounded-lg p-3 mb-4 focus:ring-2 focus:ring-indigo-400 outline-none"
        placeholder="Title" />

      <textarea id="modal-desc"
        class="w-full border rounded-lg p-3 mb-5 focus:ring-2 focus:ring-indigo-400 outline-none" rows="4"
        placeholder="Description"></textarea>

      <div class="flex justify-end gap-3">
        <button onclick="closeModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
          Cancel
        </button>
        <button onclick="saveEdit()" class="px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const API = "https://timebank-bend-erafaucdbqercucc.eastasia-01.azurewebsites.net";
    const user = JSON.parse(localStorage.getItem("user"));
    let editId = null;

    // FIX: DOM ELEMENTS
    const editModal = document.getElementById("editModal");
    const modalTitle = document.getElementById("modal-title");
    const modalDesc = document.getElementById("modal-desc");
    const search = document.getElementById("search");

    if (!user) {
      alert("Please login first");
      location.href = "login.html";
    }

    function toggleMenu() {
      document.getElementById("mobileMenu").classList.toggle("hidden");
    }

    function logout() {
      localStorage.clear();
      location.href = "login.html";
    }

    function openFile(path) {
  fetch(API + "/file/" + path)
    .then(res => res.json())
    .then(data => {
      window.open(data.url, "_blank");
    });
}

    // LOAD RESOURCES
    fetch(`${API}/my-resources/${user.id}`)
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("list");

        if (!Array.isArray(data) || data.length === 0) {
          list.innerHTML = `
            <p class="col-span-full text-center text-gray-500 text-lg">
              No resources uploaded yet.
            </p>`;
          return;
        }

        list.innerHTML = data.map(r => `
          <div class="resource-card bg-white rounded-2xl shadow-md hover:shadow-xl
               hover:-translate-y-2 transition w-[320px] flex flex-col overflow-hidden">

            <div class="p-5 border-b bg-gradient-to-r from-indigo-50 to-purple-50">
              <h3 class="font-bold text-lg text-indigo-800 truncate">${r.title}</h3>
              <p class="text-gray-600 text-sm line-clamp-2">
                ${r.description || "No description provided"}
              </p>
            </div>

<div class="p-4">
<div class="h-44 rounded-xl bg-gray-100 border flex items-center justify-center cursor-pointer"
     onclick="openFile('${r.file_path}')">
  ${
    r.file_type === "video"
      ? `<span class="text-indigo-600 font-semibold">‚ñ∂ Play Video</span>`
      : r.file_type === "pdf"
      ? `<span class="text-indigo-600 font-semibold">üìÑ Open PDF</span>`
      : `<span class="text-gray-400">Open File</span>`
  }
</div>


  <span class="inline-block mt-3 text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full">
    ${r.file_type?.toUpperCase() || "FILE"}
  </span>
</div>


            <div class="flex justify-between items-center px-5 py-3 border-t bg-gray-50 text-sm">
              <button onclick="openEdit(${r.id}, '${escapeStr(r.title)}', '${escapeStr(r.description || "")}')"
                class="text-indigo-600 font-semibold">
                 Edit
              </button>
              <button onclick="deleteResource(${r.id})"
                class="text-red-500 font-semibold">
                 Delete
              </button>
            </div>
          </div>
        `).join("");
      });

    function escapeStr(str) {
      return str.replace(/'/g, "\\'");
    }

    function openEdit(id, title, desc) {
      editId = id;
      modalTitle.value = title;
      modalDesc.value = desc;
      editModal.classList.remove("hidden");
      editModal.classList.add("flex");
    }

    function closeModal() {
      editModal.classList.add("hidden");
      editModal.classList.remove("flex");
    }

    function saveEdit() {
      fetch(`${API}/update-resource/${editId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          title: modalTitle.value,
          description: modalDesc.value,
          userId: user.id
        })
      }).then(() => location.reload());
    }

    function deleteResource(id) {
      if (!confirm("Delete this resource?")) return;
      fetch(`${API}/delete-resource/${id}/${user.id}`, { method: "DELETE" })
        .then(() => location.reload());
    }

    function filterResources() {
      const q = search.value.toLowerCase();
      document.querySelectorAll(".resource-card").forEach(card => {
        card.style.display = card.innerText.toLowerCase().includes(q)
          ? "block"
          : "none";
      });
    }
  </script>

</body>

</html>